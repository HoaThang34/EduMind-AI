{% extends "base.html" %}
{% block title %}Th√™m ƒêi·ªÉm C·ªông{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>
    .select2-container .select2-selection--multiple {
        border: 1px solid #cbd5e1 !important;
        border-radius: 0.5rem !important;
        min-height: 45px;
        padding: 6px;
        background-color: white;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        background-color: #d1fae5;
        border: 1px solid #6ee7b7;
        color: #065f46;
        border-radius: 4px;
        padding: 2px 8px;
        font-weight: 600;
        margin-top: 4px;
        margin-right: 6px;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
        color: #065f46;
        border-right: 1px solid #6ee7b7;
        margin-right: 6px;
        padding-right: 6px;
    }

    .select2-container--default.select2-container--focus .select2-selection--multiple {
        border-color: #10b981 !important;
        box-shadow: 0 0 0 1px #10b981;
        outline: none;
    }

    .select2-container--default .select2-results__option--highlighted.select2-results__option--selectable {
        background-color: #10b981;
        color: white;
    }
</style>

<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-foreground">üåü Th√™m ƒêi·ªÉm C·ªông</h1>
        <p class="text-muted-foreground">Ghi nh·∫≠n th√†nh t√≠ch, ti·∫øn b·ªô ho·∫∑c tham gia cu·ªôc thi c·ªßa h·ªçc sinh.</p>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border border-[hsl(240,5.9%,90%)]">
        <form method="POST" action="{{ url_for('add_bonus') }}" class="space-y-5">

            <div>
                <label class="block text-sm font-medium text-foreground mb-1">Ch·ªçn H·ªçc Sinh:</label>
                <select name="student_ids[]" multiple="multiple" id="student-select-bonus" class="w-full"
                    style="width: 100%" required>
                    {% for s in students %}
                    <option value="{{ s.id }}">
                        {{ s.student_code }} - {{ s.name }} ({{ s.student_class }})
                    </option>
                    {% endfor %}
                </select>
                <p class="text-xs text-muted-foreground mt-1">
                    <i class="fas fa-info-circle"></i> G√µ t√™n, m√£ s·ªë ho·∫∑c l·ªõp ƒë·ªÉ l·ªçc. C√≥ th·ªÉ ch·ªçn nhi·ªÅu h·ªçc sinh.
                </p>
            </div>

            <div>
                <label class="block text-sm font-medium text-foreground mb-2">Lo·∫°i ƒêi·ªÉm C·ªông</label>
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4 max-h-64 overflow-y-auto space-y-2">
                    {% for bonus in bonus_types %}
                    <label class="flex items-center p-2 hover:bg-white rounded-lg cursor-pointer transition group">
                        <input type="checkbox" name="bonus_ids[]" value="{{ bonus.id }}"
                            class="w-4 h-4 text-emerald-600 border-slate-300 rounded focus:ring-emerald-500 cursor-pointer">
                        <span class="ml-3 text-sm font-medium text-foreground group-hover:text-emerald-600 flex-1">
                            {{ bonus.name }}
                        </span>
                        <span class="text-xs font-bold text-emerald-600 bg-emerald-100 px-2 py-1 rounded">
                            +{{ bonus.points_added }}ƒë
                        </span>
                    </label>
                    {% else %}
                    <p class="text-center text-gray-400 py-4">
                        Ch∆∞a c√≥ lo·∫°i ƒëi·ªÉm c·ªông.
                        <a href="{{ url_for('manage_bonus_types') }}" class="text-emerald-600 underline">Th√™m ngay</a>
                    </p>
                    {% endfor %}
                </div>
            </div>

            <div>
                <label for="reason" class="block text-sm font-medium text-foreground mb-1">L√Ω Do C·ª• Th·ªÉ (T√πy
                    ch·ªçn):</label>
                <input type="text" name="reason" id="reason" placeholder="VD: Gi·∫£i Nh√¨ HSG To√°n c·∫•p T·ªânh nƒÉm 2024"
                    class="block w-full rounded-lg border-slate-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500">
                <p class="text-xs text-muted-foreground mt-1">
                    <i class="fas fa-lightbulb"></i> Ghi chi ti·∫øt l√Ω do ƒë·ªÉ l∆∞u v√†o h·ªì s∆° h·ªçc sinh.
                </p>
            </div>

            <div class="pt-2">
                <button type="submit"
                    class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold shadow-md transition-all flex justify-center items-center gap-2">
                    <i class="fas fa-plus-circle"></i> Ghi Nh·∫≠n ƒêi·ªÉm C·ªông
                </button>
            </div>
        </form>
    </div>

    {% if bonus_types %}
    <div class="mt-6 p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-100 rounded-xl">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center">
                <i class="fas fa-lightbulb"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-emerald-800">M·∫πo hay</p>
                <p class="text-xs text-emerald-600">ƒêi·ªÉm c·ªông s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t v√†o ƒëi·ªÉm r√®n luy·ªán c·ªßa h·ªçc sinh.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
    $(document).ready(function () {
        $('#student-select-bonus').select2({
            placeholder: "üîç Nh·∫≠p t√™n ho·∫∑c m√£ s·ªë ƒë·ªÉ t√¨m...",
            allowClear: true,
            language: {
                noResults: function () {
                    return "Kh√¥ng t√¨m th·∫•y h·ªçc sinh n√†o";
                }
            }
        });
    });
</script>
{% endblock %}